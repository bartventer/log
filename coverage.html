
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>log: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/bartventer/log/context.go (100.0%)</option>
				
				<option value="file1">github.com/bartventer/log/log.go (96.0%)</option>
				
				<option value="file2">github.com/bartventer/log/options.go (100.0%)</option>
				
				<option value="file3">github.com/bartventer/log/stdlog.go (87.5%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package log

import "context"

// contextKey is the context key type.
type contextKey struct{ string }

// ContextKey is the key used to store the logger in context.
var ContextKey = contextKey{"log"}

// WithContext wraps the given logger in context.
func WithContext(ctx context.Context, logger Logger) context.Context <span class="cov8" title="1">{
        return context.WithValue(ctx, ContextKey, logger)
}</span>

// FromContext returns the logger from the given context.
// This will return the default package logger if no logger
// found in context.
func FromContext(ctx context.Context) Logger <span class="cov8" title="1">{
        if logger, ok := ctx.Value(ContextKey).(Logger); ok </span><span class="cov8" title="1">{
                return logger
        }</span>
        <span class="cov8" title="1">return New()</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">// Package log provides a structured logger with context support.
// It is built on top of the [github.com/charmbracelet/log] package.
package log

import (
        "context"
        "io"
        "log/slog"
        "os"
        "sync"
        "sync/atomic"

        "github.com/charmbracelet/log"
)

// DefaultStyles returns the default styles.
// It applies custom styles to the [log.DefaultStyles].
func DefaultStyles() *Styles <span class="cov8" title="1">{
        defaultStylesOnce.Do(func() </span><span class="cov8" title="1">{
                defaultStylesOnce.s = log.DefaultStyles()

                // ========= Level styles =========
                // Disable truncation for all levels
                defaultStylesOnce.s.Levels[log.DebugLevel] = defaultStylesOnce.s.Levels[log.DebugLevel].MaxWidth(5)
                defaultStylesOnce.s.Levels[log.InfoLevel] = defaultStylesOnce.s.Levels[log.InfoLevel].MaxWidth(4)
                defaultStylesOnce.s.Levels[log.WarnLevel] = defaultStylesOnce.s.Levels[log.WarnLevel].MaxWidth(4)
                defaultStylesOnce.s.Levels[log.ErrorLevel] = defaultStylesOnce.s.Levels[log.ErrorLevel].MaxWidth(5)
                defaultStylesOnce.s.Levels[log.FatalLevel] = defaultStylesOnce.s.Levels[log.FatalLevel].MaxWidth(5)
        }</span>)

        <span class="cov8" title="1">return defaultStylesOnce.s</span>
}

var defaultStylesOnce struct {
        sync.Once
        s *log.Styles
}

var defaultOnce struct {
        sync.Once
        l atomic.Pointer[slog.Logger]
}

// Default returns the default logger.
func Default() *slog.Logger <span class="cov8" title="1">{
        defaultOnce.Do(func() </span><span class="cov8" title="1">{
                if defaultOnce.l.Load() != nil </span><span class="cov0" title="0">{
                        return
                }</span>
                <span class="cov8" title="1">defaultOnce.l.Store(New(WithDefault()))</span>
        })
        <span class="cov8" title="1">return defaultOnce.l.Load()</span>
}

// SetOutput sets the writer for the default logger.
func SetOutput(l *slog.Logger, w io.Writer) <span class="cov8" title="1">{
        l.Handler().(*log.Logger).SetOutput(w)
}</span>

// Logger defines the [slog.Logger] interface.
type Logger interface {
        Debug(msg string, args ...any)
        DebugContext(ctx context.Context, msg string, args ...any)
        Enabled(ctx context.Context, level slog.Level) bool
        Error(msg string, args ...any)
        ErrorContext(ctx context.Context, msg string, args ...any)
        Handler() slog.Handler
        Info(msg string, args ...any)
        InfoContext(ctx context.Context, msg string, args ...any)
        Log(ctx context.Context, level slog.Level, msg string, args ...any)
        LogAttrs(ctx context.Context, level slog.Level, msg string, attrs ...slog.Attr)
        Warn(msg string, args ...any)
        WarnContext(ctx context.Context, msg string, args ...any)
        With(args ...any) *slog.Logger
        WithGroup(name string) *slog.Logger
}

// New creates a new logger with the given options.
func New(opts ...Option) *slog.Logger <span class="cov8" title="1">{
        o := &amp;Options{
                LogOptions: &amp;LogOptions{
                        Level: log.InfoLevel,
                },
                Writer: os.Stderr,
                Styles: DefaultStyles(),
        }
        o.apply(opts...)

        handler := log.NewWithOptions(o.Writer, *o.LogOptions)

        if o.Styles != nil </span><span class="cov8" title="1">{
                handler.SetStyles(o.Styles)
        }</span>

        <span class="cov8" title="1">l := slog.New(handler)

        if o.Default </span><span class="cov8" title="1">{
                log.SetDefault(handler)
                slog.SetDefault(l)
                defaultOnce.l.Store(l)
        }</span>

        <span class="cov8" title="1">return l</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package log

import (
        "io"
        "log/slog"
        "time"

        "github.com/charmbracelet/log"
)

// Type Aliases
type (
        LogOptions      = log.Options
        Level           = log.Level
        CallerFormatter = log.CallerFormatter
        Formatter       = log.Formatter
        Styles          = log.Styles
)

// Options is the logger options.
type Options struct {
        *LogOptions
        Writer  io.Writer   // Writer is the writer for the logger. Default is [os.Stderr].
        Styles  *log.Styles // Styles is the styles for the logger. Default is [DefaultStyles].
        Default bool        // Default is whether the logger is the default logger. Default is false.
}

func (o *Options) apply(opts ...Option) <span class="cov8" title="1">{
        for _, opt := range opts </span><span class="cov8" title="1">{
                opt(o)
        }</span>
}

// Option is a logger option.
type Option func(*Options)

// Log Levels
const (
        DebugLevel Level = log.DebugLevel
        InfoLevel  Level = log.InfoLevel
        WarnLevel  Level = log.WarnLevel
        ErrorLevel Level = log.ErrorLevel
        FatalLevel Level = log.FatalLevel
)

// Caller Formatters
var (
        ShortCallerFormatter = log.ShortCallerFormatter
        LongCallerFormatter  = log.LongCallerFormatter
)

// Formatters
const (
        TextFormatter   Formatter = log.TextFormatter
        JSONFormatter   Formatter = log.JSONFormatter
        LogfmtFormatter Formatter = log.LogfmtFormatter
)

//  +------------------------------------------------------------+
//  | Option Functions                                                                                           |
//  +------------------------------------------------------------+

// WithTimeFunction sets the time function option. Default is [time.Now].
func WithTimeFunction(f func(time.Time) time.Time) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.TimeFunction = f
        }</span>
}

// WithTimeFormat sets the time format option. Default is [log.DefaultTimeFormat].
func WithTimeFormat(f string) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.TimeFormat = f
        }</span>
}

// WithLevel sets the level option. Default is [log.InfoLevel].
func WithLevel(l Level) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.Level = l
        }</span>
}

// WithPrefix sets the prefix option. Default is no prefix.
func WithPrefix(p string) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.Prefix = p
        }</span>
}

// WithReportTimestamp sets the report timestamp option. Default is false.
func WithReportTimestamp(r bool) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.ReportTimestamp = r
        }</span>
}

// WithReportCaller sets the report caller option. Default is false.
func WithReportCaller(r bool) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.ReportCaller = r
        }</span>
}

// WithCallerFormatter sets the caller formatter option. Default is [log.ShortCallerFormatter].
func WithCallerFormatter(f CallerFormatter) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.CallerFormatter = f
        }</span>
}

// WithFields sets the fields option. Default is no fields.
func WithFields(fields map[string]slog.Value) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                for k, v := range fields </span><span class="cov8" title="1">{
                        o.Fields = append(o.Fields, k, v)
                }</span>
        }
}

// WithFormatter sets the formatter option. Default is [TextFormatter].
func WithFormatter(f Formatter) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.Formatter = f
        }</span>
}

// WithCallerOffset sets the caller offset option. Default is 0.
func WithCallerOffset(offset int) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.CallerOffset = offset
        }</span>
}

// WithWriter sets the writer option. Default is [os.Stderr].
func WithWriter(w io.Writer) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.Writer = w
        }</span>
}

// WithStyles sets the styles option. Default is [DefaultStyles].
func WithStyles(s *Styles) Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.Styles = s
        }</span>
}

// WithDefault sets the default option to true.
func WithDefault() Option <span class="cov8" title="1">{
        return func(o *Options) </span><span class="cov8" title="1">{
                o.Default = true
        }</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package log

import (
        stdlog "log"
        "log/slog"

        "github.com/charmbracelet/log"
)

type (
        // StandardLogOptions can be used to configure the standard log adapter.
        StandardLogOptions struct {
                log.StandardLogOptions
                Logger *slog.Logger // Log is the logger to use. Default is the default logger.
        }

        // StandardLogOption is a standard logger option.
        StandardLogOption func(*StandardLogOptions)
)

// StandardLog creates a new standard logger with the given options.
func StandardLog(opts ...StandardLogOption) *stdlog.Logger <span class="cov8" title="1">{
        o := &amp;StandardLogOptions{}
        for _, opt := range opts </span><span class="cov8" title="1">{
                opt(o)
        }</span>

        <span class="cov8" title="1">if o.Logger != nil </span><span class="cov8" title="1">{
                return o.Logger.Handler().(*log.Logger).StandardLog(o.StandardLogOptions)
        }</span>

        <span class="cov8" title="1">if defaultOnce.l.Load() == nil </span><span class="cov0" title="0">{
                _ = Default()
        }</span>

        <span class="cov8" title="1">return log.StandardLog(o.StandardLogOptions)</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
